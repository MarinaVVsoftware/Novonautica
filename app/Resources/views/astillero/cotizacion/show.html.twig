{% extends 'estructura/plantilla.twig' %}
{% import 'estructura/modalborrar.twig' as modal %}
{% block contwrapper %}
    <div class="content-wrapper">
        <section class="content">
            <div class="panel panel-novo">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 class="panel-title">Cotización Astillero</h3>
                            <span>
                                {% if astilleroCotizacion.folio == 0 %}
                                    Pendiente para finalizar
                                {% else %}
                                    {% if astilleroCotizacion.foliorecotiza == 0 %}
                                        {{ astilleroCotizacion.folio }}
                                    {% else %}
                                        {{ astilleroCotizacion.folio }}-{{ astilleroCotizacion.foliorecotiza }}
                                    {% endif %}
                                {% endif %}
                            </span>
                        </div>
                        <div class="col-sm-6">
                            <a class="btn btn-contorno-azul pull-right"
                               href="{% if astilleroCotizacion.borrador %} {{ path('astillero_borrador_index') }} {% else %} {{ path('astillero_index') }} {% endif %}">
                                Regresar
                            </a>
                        </div>
                    </div>
                </div>
                <div class="panel-body panel-pestanias">
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="primero active">
                            <a href="#generales" aria-controls="generales" role="tab" data-toggle="tab">Generales</a>
                        </li>
                        <li role="presentation">
                            <a href="#servicios" aria-controls="servicios" role="tab" data-toggle="tab">Totales</a>
                        </li>
                        <li role="presentation">
                            <a href="#correo" aria-controls="correo" role="tab" data-toggle="tab">Correo</a>
                        </li>
                        {% if astilleroCotizacion.validacliente == 2 %}
                            <li role="presentation">
                                <a href="#pagos" aria-controls="pagos" role="tab" data-toggle="tab">Pagos</a>
                            </li>
                        {% endif %}
                    </ul>
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="generales">
                            <div class="row">
                                <div class="col-sm-10 col-sm-offset-1">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th>Folio</th>
                                            <td>
                                                {% if astilleroCotizacion.borrador %}
                                                    Pendiente para finalizar
                                                {% else %}
                                                    {% if astilleroCotizacion.foliorecotiza == 0 %}
                                                        {{ astilleroCotizacion.folio }}
                                                    {% else %}
                                                        {{ astilleroCotizacion.folio }}-{{ astilleroCotizacion.foliorecotiza }}
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Cliente</th>
                                            <td>{{ astilleroCotizacion.barco.cliente }}</td>
                                        </tr>
                                        <tr>
                                            <th>Correo</th>
                                            <td>{{ astilleroCotizacion.barco.cliente.correo }}</td>
                                        </tr>
                                        <tr>
                                            <th>Teléfono</th>
                                            <td>{{ astilleroCotizacion.barco.cliente.telefono }}</td>
                                        </tr>
                                        <tr>
                                            <th>Barco</th>
                                            <td>{{ astilleroCotizacion.barco }}</td>
                                        </tr>
                                        <tr>
                                            <th>Eslora</th>
                                            <td>{{ astilleroCotizacion.barco.eslora }}</td>
                                        </tr>
                                        <tr>
                                            <th>Fecha inicio</th>
                                            <td>{% if astilleroCotizacion.fechaLlegada %}{{ astilleroCotizacion.fechaLlegada|date('d/m/Y') }}{% endif %}</td>
                                        </tr>
                                        <tr>
                                            <th>Fecha fin</th>
                                            <td>{% if astilleroCotizacion.fechaSalida %}{{ astilleroCotizacion.fechaSalida|date('d/m/Y') }}{% endif %}</td>
                                        </tr>
                                        <tr>
                                            <th>Fecha cotización</th>
                                            <td>{% if astilleroCotizacion.fecharegistro %}{{ astilleroCotizacion.fecharegistro|date('d/m/Y H:i:s') }}{% endif %}</td>
                                        </tr>
                                        <tr>
                                            <th>Creó la cotización</th>
                                            <td>{{ astilleroCotizacion.creador }}</td>
                                        </tr>
                                        {% if astilleroCotizacion.borrador == false %}
                                        <tr>
                                            <th>Estatus validación</th>
                                            <td>
                                                {% if astilleroCotizacion.validanovo == 0 %}
                                                    Pendiente validación de Novonautica
                                                {% elseif astilleroCotizacion.validanovo == 1 %}
                                                    Rechazado por {{ astilleroCotizacion.nombrevalidanovo }}
                                                {% elseif astilleroCotizacion.validanovo == 2 %}
                                                    Aprobado por {{ astilleroCotizacion.nombrevalidanovo }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>Estatus aceptación</th>
                                            <td>
                                                {% if astilleroCotizacion.validacliente == 0 %}
                                                    Pendiente aceptación del cliente
                                                {% elseif astilleroCotizacion.validacliente == 1 %}
                                                    Rechazado por el cliente
                                                {% elseif astilleroCotizacion.validacliente == 2 %}
                                                    Aprobado por el cliente
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endif %}
                                        {% if astilleroCotizacion.validacliente == 2 %}
                                            <tr>
                                                <th>Estatus Pago</th>
                                                <td>
                                                    {% if astilleroCotizacion.estatuspago == 2 %}
                                                        Pagado
                                                    {% elseif astilleroCotizacion.estatuspago == 1 %}
                                                        Con adeudo
                                                    {% else %}
                                                        No pagado
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endif %}
                                        <tr>
                                            <th>Límite aceptación cliente</th>
                                            <td>
                                                {% if astilleroCotizacion.limiteValidaCliente %}
                                                {{ astilleroCotizacion.limiteValidaCliente|date('d/m/Y') }}
                                                {% endif %}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>¿Requiere factura?</th>
                                            <td>
                                                {% if astilleroCotizacion.requerirFactura %}
                                                    Si
                                                    {% else %}
                                                    No
                                                {% endif %}
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-10 col-sm-offset-1">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th>Capitán</th>
                                            <td>{{ astilleroCotizacion.barco.nombreCapitan }}</td>
                                        </tr>
                                        <tr>
                                            <th>Correo capitán</th>
                                            <td>{{ astilleroCotizacion.barco.correoCapitan }}</td>
                                        </tr>
                                        <tr>
                                            <th>Teléfono capitán</th>
                                            <td>{{ astilleroCotizacion.barco.telefonoCapitan }}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-10 col-sm-offset-1">
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <th>Responsable</th>
                                            <td>{{ astilleroCotizacion.barco.nombreResponsable }}</td>
                                        </tr>
                                        <tr>
                                            <th>Correo responsable</th>
                                            <td>{{ astilleroCotizacion.barco.correoResponsable }}</td>
                                        </tr>
                                        <tr>
                                            <th>Teléfono responsable</th>
                                            <td>{{ astilleroCotizacion.barco.telefonoResponsable }}</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {% if astilleroCotizacion.validanovo == 1 %}
                            <div class="row">
                                <div class="col-sm-10 col-sm-offset-1">
                                    <label>Observaciones:</label>
                                    <div class="info-input"><p>{{ astilleroCotizacion.notasnovo }}</p></div>
                                </div>
                            </div>
                            {% endif %}
                            {% if astilleroCotizacion.validacliente == 1 %}
                                <div class="row">
                                    <div class="col-sm-10 col-sm-offset-1">
                                        <label>Observaciones:</label>
                                        <div class="info-input"><p>{{ astilleroCotizacion.notascliente }}</p></div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        <div role="tabpanel" class="tab-pane" id="servicios">
                            <div class="row">
                                <div class="col-sm-12 text-right">
                                    <span>Tipo de cambio:</span> {{ (astilleroCotizacion.dolar/100)|number_format(2)}} <small>MXN</small>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 text-right">
                                    <div id="valorsistemaiva" class="">
                                        IVA: {{ astilleroCotizacion.iva }} %
                                    </div>
                                </div>
                            </div>
                            {% if astilleroCotizacion.descuento %}
                            <div class="row">
                                <div class="col-sm-12 text-right">
                                    Descuento: {{ astilleroCotizacion.descuento }} %
                                </div>
                            </div>
                            {% endif %}
                            <div class="row">
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-azul" type="button" data-toggle="collapse"
                                            data-target="#fila-tabla-servicios-basicos" aria-expanded="false"
                                            aria-controls="collapseExample">
                                        <i class="fa fa-compress" aria-hidden="true"></i> Desplegar
                                    </button>
                                </div>
                                <div class="col-sm-10">
                                    <h3 class="mt-0">Servicios básicos</h3>
                                </div>
                            </div>
                            <div class="row collapse" id="fila-tabla-servicios-basicos">
                                <div class="col-sm-12">
                                    <table id="serviciosbasicos" class="table text-center">
                                        <thead>
                                        <tr>
                                            <th class="col-sm-1">Cantidad</th>
                                            <th class="col-sm-2">Servicio</th>
                                            <th class="col-sm-1">Prec. Unid.</th>
                                            <th class="col-sm-1">Sub-Total</th>
                                            <th class="col-sm-1">IVA</th>
                                            <th class="col-sm-1">Total</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for AstilleroServicio in astilleroCotizacion.acservicios %}
                                            {% if AstilleroServicio.estatus %}
                                                {% if AstilleroServicio.astilleroserviciobasico %}
                                                    <tr>
                                                        <td>
                                                            {% if (AstilleroServicio.astilleroserviciobasico.id == 2 or AstilleroServicio.astilleroserviciobasico.id == 9) %}
                                                                {{ AstilleroServicio.cantidad/astilleroCotizacion.barco.eslora }} (pie por día)
                                                            {% else %}
                                                                {{ AstilleroServicio.cantidad }}
                                                            {% endif %}
                                                        </td>
                                                        <td>{{ AstilleroServicio.astilleroserviciobasico.nombre }}</td>
                                                        <td>$ {{ AstilleroServicio.precio|number_format(2) }}
                                                            <small>{{ AstilleroServicio.divisa }}</small></td>
                                                        <td>$ {{ AstilleroServicio.subtotal|number_format(2) }} <small>MXN</small></td>
                                                        <td>$ {{ AstilleroServicio.iva|number_format(2) }} <small>MXN</small></td>
                                                        <td>$ {{ AstilleroServicio.total|number_format(2) }} <small>MXN</small></td>
                                                    </tr>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row espacio-linea">
                                <div class="col-sm-12">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-azul" type="button" data-toggle="collapse"
                                            data-target="#fila-tabla-servicios" aria-expanded="false"
                                            aria-controls="collapseExample">
                                        <i class="fa fa-compress" aria-hidden="true"></i> Desplegar
                                    </button>
                                </div>
                                <div class="col-sm-10">
                                    <h3 class="mt-0">Servicios</h3>
                                </div>
                            </div>
                            <div class="row collapse" id="fila-tabla-servicios">
                                <div class="col-sm-12">
                                    <table class="table text-center">
                                        <thead>
                                        <tr>
                                            <th class="col-sm-1">Cantidad</th>
                                            <th class="col-sm-2">Servicio</th>
                                            <th class="col-sm-1">Prec. Unid.</th>
                                            <th class="col-sm-1">Sub-Total</th>
                                            <th class="col-sm-1">IVA</th>
                                            <th class="col-sm-1">Total</th>
                                            <th class="col-sm-1">Días descuento</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for AstilleroServicio in astilleroCotizacion.acservicios %}
                                            {% if AstilleroServicio.estatus %}
                                                {% if AstilleroServicio.servicio %}
                                                    <tr>
                                                        <td>{{ AstilleroServicio.cantidad }}</td>
                                                        <td>{{ AstilleroServicio.servicio.nombre }}</td>
                                                        <td>$ 
                                                            {% if AstilleroServicio.divisa == "MXN" %}
                                                                {{ AstilleroServicio.precio|number_format(2) }}
                                                            {% else %}
                                                                {{ (AstilleroServicio.precio/(astilleroCotizacion.dolar/100))|number_format(2) }}
                                                            {% endif %}
                                                            <small>{{ AstilleroServicio.divisa }}</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.subtotal|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.iva|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.total|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>{{ AstilleroServicio.promedio }}</td>
                                                    </tr>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row espacio-linea">
                                <div class="col-sm-12">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-azul" type="button" data-toggle="collapse"
                                            data-target="#fila-tabla-otros" aria-expanded="false"
                                            aria-controls="collapseExample">
                                        <i class="fa fa-compress" aria-hidden="true"></i> Desplegar
                                    </button>
                                </div>
                                <div class="col-sm-10">
                                    <h3 class="mt-0">Otros</h3>
                                </div>
                            </div>
                            <div class="row collapse" id="fila-tabla-otros">
                                <div class="col-sm-12">
                                    <table class="table text-center">
                                        <thead>
                                        <tr>
                                            <th class="col-sm-1">Cantidad</th>
                                            <th class="col-sm-2">Servicio</th>
                                            <th class="col-sm-1">Prec. Unid.</th>
                                            <th class="col-sm-1">Sub-Total</th>
                                            <th class="col-sm-1">IVA</th>
                                            <th class="col-sm-1">Total</th>
                                        </tr>
                                        </thead>
                                        <tbody id="otros" class="lista-servicios">
                                        {% for AstilleroServicio in astilleroCotizacion.acservicios %}
                                            {% if AstilleroServicio.estatus %}
                                                {% if AstilleroServicio.otroservicio %}
                                                    <tr>
                                                        <td>{{ AstilleroServicio.cantidad }}</td>
                                                        <td>{{ AstilleroServicio.otroservicio }}</td>
                                                        <td>$ {{ AstilleroServicio.precio|number_format(2) }}
                                                            <small>{{ AstilleroServicio.divisa }}</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.subtotal|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.iva|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.total|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row espacio-linea">
                                <div class="col-sm-12">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-2">
                                    <button class="btn btn-sm btn-azul" type="button" data-toggle="collapse"
                                            data-target="#fila-tabla-productos" aria-expanded="false"
                                            aria-controls="collapseExample">
                                        <i class="fa fa-compress" aria-hidden="true"></i> Desplegar
                                    </button>
                                </div>
                                <div class="col-sm-10">
                                    <h3 class="mt-0">Productos</h3>
                                </div>
                            </div>
                            <div class="row collapse" id="fila-tabla-productos">
                                <div class="col-sm-12">
                                    <table class="table text-center">
                                        <thead>
                                        <tr>
                                            <th class="col-sm-1">Cantidad</th>
                                            <th class="col-sm-2">Producto</th>
                                            <th class="col-sm-1">Prec. Unid.</th>
                                            <th class="col-sm-1">Sub-Total</th>
                                            <th class="col-sm-1">IVA</th>
                                            <th class="col-sm-1">Total</th>
                                        </tr>
                                        </thead>
                                        <tbody id="productos" class="lista-servicios">
                                        {% for AstilleroServicio in astilleroCotizacion.acservicios %}
                                            {% if AstilleroServicio.estatus %}
                                                {% if AstilleroServicio.producto %}
                                                    <tr>
                                                        <td>{{ AstilleroServicio.cantidad }}</td>
                                                        <td>{{ AstilleroServicio.producto.nombre }}</td>
                                                        <td>$ {{ AstilleroServicio.precio|number_format(2) }}
                                                            <small>{{ AstilleroServicio.divisa }}</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.subtotal|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.iva|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                        <td>$ {{ AstilleroServicio.total|number_format(2) }}
                                                            <small>MXN</small>
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6 col-sm-offset-6">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4 col-sm-offset-4 text-right tipo-letra1">
                                    <p class="letra-azul">Sub-Total:</p>
                                    <p>
                                        $
                                        <span id="gransubtot">{{ astilleroCotizacion.subtotal|number_format(2) }}</span>
                                        <span class="tipo-letra2">MXN</span>
                                    </p>
                                </div>
                                <div class="col-sm-4 text-right tipo-letra1">
                                    <p class="letra-azul">Sub-Total:</p>
                                    <p>
                                        $
                                        <span id="gransubtot">{{ (astilleroCotizacion.subtotal/(astilleroCotizacion.dolar/100))|number_format(2) }}</span>
                                        <span class="tipo-letra2">USD</span>
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6 col-sm-offset-6">
                                    <hr>
                                </div>
                            </div>
                            {% if astilleroCotizacion.descuento %}
                            <div class="row">
                                <div class="col-sm-4 col-sm-offset-4 text-right tipo-letra1">
                                    <p class="letra-azul">Descuento:</p>
                                    <p>
                                        $
                                        <span>{{ astilleroCotizacion.descuentototal|number_format(2) }}</span>
                                        <span class="tipo-letra2">MXN</span>
                                    </p>
                                </div>
                                <div class="col-sm-4 text-right tipo-letra1">
                                    <p class="letra-azul">Descuento:</p>
                                    <p>
                                        $
                                        <span>{{ (astilleroCotizacion.descuentototal/(astilleroCotizacion.dolar/100))|number_format(2) }}</span>
                                        <span class="tipo-letra2">USD</span>
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6 col-sm-offset-6">
                                    <hr>
                                </div>
                            </div>
                            {% endif %}
                            <div class="row">
                                <div class="col-sm-4 col-sm-offset-4 text-right tipo-letra1">
                                    <p class="letra-azul">I.V.A:</p>
                                    <p>
                                        $
                                        <span id="graniva">{{ astilleroCotizacion.ivatotal|number_format(2) }}</span>
                                        <span class="tipo-letra2">MXN</span>
                                    </p>
                                </div>
                                <div class="col-sm-4 text-right tipo-letra1">
                                    <p class="letra-azul">I.V.A:</p>
                                    <p>
                                        $
                                        <span id="graniva">{{ (astilleroCotizacion.ivatotal/(astilleroCotizacion.dolar/100))|number_format(2) }}</span>
                                        <span class="tipo-letra2">USD</span>
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6 col-sm-offset-6">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4 col-sm-offset-4 text-right tipo-letra1">
                                    <p class="letra-azul">Total:</p>
                                    <p>
                                        $
                                        <span id="grantot">{{ astilleroCotizacion.total|number_format(2) }}</span>
                                        <span class="tipo-letra2">MXN</span>
                                    </p>
                                </div>
                                <div class="col-sm-4 text-right tipo-letra1">
                                    <p class="letra-azul">Total:</p>
                                    <p>
                                        $
                                        <span id="grantot">{{ (astilleroCotizacion.total/(astilleroCotizacion.dolar/100))|number_format(2) }}</span>
                                        <span class="tipo-letra2">USD</span>
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6 col-sm-offset-6">
                                    <hr>
                                </div>
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="correo">
                            <div class="row">
                                <div class="col-sm-12">
                                    <label>Mensaje en el correo:</label>
                                    <div class="info-input">{{ astilleroCotizacion.mensaje|raw }}</div>
                                </div>
                            </div>
                        </div>
                        {% if astilleroCotizacion.validacliente == 2 %}
                        <div role="tabpanel" class="tab-pane" id="pagos">
                            <div class="row">
                                <div class="col-sm-5">
                                    <label>Total a pagar</label>
                                    <div class="info-input">
                                        $ {{ (astilleroCotizacion.total/100)|number_format(2) }} MXN
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <label></label>
                                    <div class="info-input">
                                        $ {{ (astilleroCotizacion.total/(astilleroCotizacion.dolar/100))|number_format(2) }} USD
                                    </div>
                                </div>
                            </div>
                            <div class="row espacio-linea">
                                <div class="col-sm-10">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <table class="table text-center">
                                        <thead>
                                        <tr>
                                            <th>Método de pago</th>
                                            <th>Pago</th>
                                            <th>Fecha</th>
                                            <th>Tipo de cambio</th>
                                            <th>Total en USD</th>
                                            {#<th>Factura</th>#}
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% set totUSD = 0 %}
                                        {% for pago in astilleroCotizacion.pagos %}
                                            {#{% set factura = pago.factura %}#}
                                            <tr>
                                                <td>{{ pago.metodopago }}</td>
                                                <td>$ {{ (pago.cantidad/100)|number_format(2) }} MXN</td>
                                                <td>{% if pago.fechaRealPago %}
                                                        {{ pago.fechaRealPago|date('d-m-Y') }}
                                                    {% endif %}</td>
                                                <td>$ {{ (pago.dolar/100)|number_format(2) }} MXN</td>
                                                <td>$ {{ (pago.cantidad / pago.dolar)|number_format(2) }} USD</td>
                                                {#<td>
                                                    {% if factura %}
                                                        <a href="{{ path('contabilidad_factura_pdf', { 'id': factura.id }) }}"
                                                           target="_blank"
                                                           class="remove-motor btn btn-xs btn-azul"
                                                           style="margin: 5px;"
                                                        >
                                                            PDF
                                                        </a>
                                                    {% endif %}
                                                </td>#}
                                            </tr>
                                            {% set totUSD = totUSD + (pago.cantidad / pago.dolar)  %}
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="row espacio-linea">
                                <div class="col-sm-10">
                                    <hr>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-5">
                                    <label>Pagado hasta el momento</label>
                                    <div class="info-input">
                                        $ {{ (astilleroCotizacion.pagado/100)|number_format(2) }} MXN
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <label></label>
                                    <div class="info-input">
                                        $ {{ totUSD|number_format(2) }} USD
                                    </div>
                                </div>
                            </div>
                            <div class="row espacio-linea-arriba2">
                                <div class="col-sm-5">
                                    <label>Saldo faltante</label>
                                    <div class="info-input">
                                        $ {{ ((astilleroCotizacion.total-astilleroCotizacion.pagado)/100)|number_format(2) }} MXN
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <label></label>
                                    <div class="info-input">
                                        $ {{ ((astilleroCotizacion.total-astilleroCotizacion.pagado)/(astilleroCotizacion.dolar/100))|number_format(2) }} USD
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <a target="_blank" class="btn btn-morado-claro pull-right"
                               href="{{ path('astillero-pdf',{'id':astilleroCotizacion.id,'tipo':1 }) }}">
                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                En pesos
                            </a>
                        </div>
                    </div>
                    <div class="row espacio-linea-arriba2">
                        <div class="col-sm-12">
                            <a target="_blank" class="btn btn-morado-claro pull-right"
                               href="{{ path('astillero-pdf',{'id':astilleroCotizacion.id,'tipo':2 }) }}">
                                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
                                En dolares
                            </a>
                        </div>
                    </div>
                    {% if astilleroCotizacion.validanovo == 0 and
                        is_granted(expression('has_role("ASTILLERO_COTIZACION_VALIDATE") or (user.isAdmin())')) and
                        astilleroCotizacion.borrador == false
                    %}
                        <div class="row espacio-linea-arriba2">
                            <div class="col-sm-12">
                                <a class="btn btn-azul pull-right"
                                   href="{{ path('astillero_validar', { 'id': astilleroCotizacion.id }) }}">
                                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    Validar
                                </a>
                            </div>
                        </div>
                    {% endif %}
                    {% if astilleroCotizacion.validanovo == 2 and astilleroCotizacion.validacliente == 0 and
                        is_granted(expression('has_role("ASTILLERO_COTIZACION_VALIDATE") or (user.isAdmin())'))
                    %}
                        <div class="row espacio-linea-arriba2">
                            <div class="col-sm-12">
                                <a class="btn btn-azul pull-right"
                                   href="{{ path('astillero_validar', { 'id': astilleroCotizacion.id }) }}">
                                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                    Aceptar Cliente
                                </a>
                            </div>
                        </div>
                    {% endif %}
                    {% if (astilleroCotizacion.validanovo == 1 or
                        astilleroCotizacion.validacliente == 1) and
                        astilleroCotizacion.estatus == 1 and
                        is_granted(expression('has_role("ASTILLERO_COTIZACION_REQUOTE") or (user.isAdmin())'))
                    %}
                        <div class="row espacio-linea-arriba2">
                            <div class="col-sm-12">
                                <a class="btn btn-naranja pull-right"
                                   href="{{ path('astillero_recotizar', { 'id': astilleroCotizacion.id }) }}">
                                    <i class="fa fa-pencil-square" aria-hidden="true"></i>
                                    Recotizar
                                </a>
                            </div>
                        </div>
                    {% endif %}
                    {% if astilleroCotizacion.validacliente == 2 and
                        is_granted('ROLE_ASTILLERO_PAGO')
                    %}
                        <div class="row espacio-linea-arriba2">
                            <div class="col-sm-12">
                                <a class="btn btn-verde pull-right"
                                   href="{{ path('astillero_cotizacion_pago_edit',{'id': astilleroCotizacion.id}) }}">
                                    <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                                    Pagos
                                </a>
                            </div>
                        </div>
                    {% endif %}
                    {% if astilleroCotizacion.validanovo == 2 and astilleroCotizacion.validacliente != 1 %}
                        <div class="row espacio-linea-arriba2">
                            <div class="col-sm-12">
                                <button class="btn btn-naranja pull-right loadpage" id="reenviar"
                                        data-idcotizacion="{{astilleroCotizacion.id }}">
                                    <i class="fa fa-paper-plane-o" aria-hidden="true"></i>
                                    Reenviar
                                </button>
                            </div>
                        </div>
                    {% endif %}
                    {% if astilleroCotizacion.estatus and
                        is_granted(expression('has_role("ASTILLERO_COTIZACION_CREATE") or (user.isAdmin())'))
                    %}
                        {% if astilleroCotizacion.borrador %}
                            <div class="row espacio-linea-arriba2">
                                <div class="col-sm-12">
                                    <a class="btn btn-azul pull-right"
                                       href="{{ path('astillero_editar', { 'id': astilleroCotizacion.id }) }}">
                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                        Editar
                                    </a>
                                </div>
                            </div>
                        {% endif %}
                        {% if  astilleroCotizacion.validacliente == 2 %}
                            <div class="row espacio-linea-arriba2">
                                <div class="col-sm-12">
                                    <a class="btn btn-gris pull-right"
                                       href="{{ path('astillero_cotizacion_adicionales', { 'id': astilleroCotizacion.id }) }}">
                                        <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                                        Adicional
                                    </a>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                    {% if  astilleroCotizacion.validanovo == 0 and
                        is_granted(expression('has_role("ASTILLERO_COTIZACION_DELETE") or (user.isAdmin())'))
                    %}
                    <div class="row">
                        <div class="col-sm-12">
                            {{ delete_form is defined ? modal.deleteButton('Cotización') : '' }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $('#reenviar').on('click',function () {
            var url = "{{ path('astillero_reenviar',{'id':'idcotizacion'}) }}";
            url = url.replace("idcotizacion", $(this).data('idcotizacion'));
            $.ajax({
                method: "POST",
                url: url,
                success: function () {
                    $('#loading').hide();
                    $('#estatusEnvio').modal('show');
                    setTimeout(function(){  $('#estatusEnvio').modal('hide'); }, 3000);
                }
            });
        });
    </script>
{% endblock %}
{% block modals %}
    <div id="estatusEnvio" class="modal fade ventanaborrar" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Mensaje</h4>
                </div>
                <div class="modal-body">
                    <p>Correo enviado con éxito</p>
                </div>
                <div class="modal-footer">

                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    {{ delete_form is defined ? modal.deleteModal(delete_form) : '' }}
{% endblock %}
