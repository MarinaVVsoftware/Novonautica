security:
    encoders:
        AppBundle\Entity\Usuario: bcrypt

    providers:
        Usuario:
            entity:
                class: AppBundle:Usuario

    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false

        main:
            anonymous: ~
            pattern: .*
            security: true
            provider: Usuario
            logout_on_user_change: true
            methods: [GET, POST]
            form_login:
                check_path: login
                login_path: login

                # Login correctamente
                always_use_default_target_path: false
                default_target_path: inicio
                target_path_parameter: _target_path
                use_referer: false

                # Login erroneo
                failure_path: login
                failure_forward: false
                failure_path_parameter: _failure_path

                # Parametros para formulario de login
                username_parameter: _correo
                password_parameter: _password

                # Protecci√≥n csrf
                csrf_token_generator: security.csrf.token_manager

                # Solo permite login a traves del metodo post
                post_only: true

                # Guarda la sesion para evitar doble login
                require_previous_session: true
            logout:
                path: logout
                target: login
                invalidate_session: false

    access_control:
        - { path: ^/login, roles: IS_AUTHENTICATED_ANONYMOUSLY }

        - { path: ^/cliente, roles: ROLE_CLIENTE }

        - { path: ^/marina/monedero, roles: ROLE_MARINA_MONEDERO }
        - { path: ^/marina/slip, roles: ROLE_MARINA_SLIP }
        - { path: ^/marina/servicios-adicionales, roles: ROLE_MARINA_SERVICIOADICIONAL }
        - { path: ^/marina/cotizacion/estadia/tarifas, roles: ROLE_MARINA_TARIFF }
        - { path: ^/marina, roles: ROLE_MARINA }

        - { path: ^/astillero/odt, roles: ROLE_ASTILLERO_ODT }
        - { path: ^/astillero/producto, roles: ROLE_ASTILLERO_PRODUCTO }
        - { path: ^/astillero/servicio, roles: ROLE_ASTILLERO_SERVICIO }
        - { path: ^/astillero, roles: ROLE_ASTILLERO }

        - { path: ^/embarcacion, roles: ROLE_EMBARCACION }
        - { path: ^/tienda, roles: ROLE_TIENDA }
        - { path: ^/contabilidad, roles: ROLE_CONTABILIDAD }
        - { path: ^/historial-correo, roles: ROLE_HCORREO }
        - { path: ^/usuario, roles: ROLE_RH }
        - { path: ^/ajustes, roles: ROLE_ADMIN }
        - { path: ^/.*, roles: ROLE_USER }

    role_hierarchy:
        ROLE_WHOLE_MARINA: [ROLE_MARINA, ROLE_MARINA_MONEDERO, ROLE_MARINA_SLIP, ROLE_MARINA_SERVICIOADICIONAL, ROLE_MARINA_TARIFF, ROLE_MARINA_PAGO]
        ROLE_WHOLE_ASTILLERO: [ROLE_ASTILLERO, ROLE_ASTILLERO_PAGO, ROLE_ASTILLERO_ODT]
        ROLE_ADMIN: [ROLE_USER, ROLE_CLIENTE, ROLE_WHOLE_MARINA, ROLE_WHOLE_ASTILLERO, ROLE_EMBARCACION, ROLE_TIENDA, ROLE_CONTABILIDAD, ROLE_HCORREO, ROLE_RH, ROLE_AJUSTES]