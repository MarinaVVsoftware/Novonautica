<?php

namespace AppBundle\Repository\Tienda\Venta;

/**
 * ConceptoRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ConceptoRepository extends \Doctrine\ORM\EntityRepository
{
    public function getAllByVenta($ventaId)
    {
        return $this->getEntityManager()
            ->createQuery(
                'SELECT concepto, producto '.
                'FROM AppBundle:Tienda\Venta\Concepto concepto '.
                'LEFT JOIN concepto.producto producto '.
                'WHERE IDENTITY(concepto.venta) = ?1'
            )
            ->setParameter(1, $ventaId)
            ->getResult();
    }

    /**
     * El metodo de getOneWithCatalogo es para las facturaciones genera los conceptos de la tabla
     *
     * @param $id
     *
     * @return array
     */
    public function getOneWithCatalogo($id)
    {
        $manager = $this->getEntityManager();

        $cotizacion = $manager->createQuery(
            'SELECT '.
            'concepto.cantidad AS conceptoCantidad, concepto.total AS conceptoImporte, '.
            'producto.nombre AS conceptoDescripcion, '.
            'cps.id AS cpsId, cps.descripcion as cpsDescripcion, '.
            'cu.id AS cuId, cu.nombre AS cuDescripcion '.
            'FROM AppBundle:Tienda\Venta\Concepto concepto '.
            'LEFT JOIN concepto.producto producto '.
            'LEFT JOIN producto.claveProdServ cps '.
            'LEFT JOIN producto.claveUnidad cu '.
            'WHERE concepto.venta = :id')
            ->setParameter('id', $id)
            ->getArrayResult();

        return $cotizacion;
    }
}
